users (
  id UUID PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT now()
)

auth_sessions (
  id UUID PRIMARY KEY,                            -- Session ID
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  refresh_token_hash TEXT NOT NULL,              -- Hash of refresh token (never store raw token)
  user_agent TEXT,                               -- Browser or device string
  ip_address TEXT,
  device_name TEXT,                              -- Optional (e.g., "MacBook Pro", "iPhone")
  is_valid BOOLEAN DEFAULT true,                 -- Soft revocation
  created_at TIMESTAMP NOT NULL DEFAULT now(),
  expires_at TIMESTAMP NOT NULL,
  last_used_at TIMESTAMP                         -- When the refresh token was last rotated
)

auth_logs (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  session_id UUID REFERENCES auth_sessions(id) ON DELETE CASCADE,
  event_type TEXT CHECK (event_type IN ('login', 'logout', 'refresh', 'revoked')),
  ip_address TEXT,
  user_agent TEXT,
  event_time TIMESTAMP NOT NULL DEFAULT now()
)
